<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - ArtDei</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Montserrat:wght@300;400;500;600&family=Tangerine:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .admin-page {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--soft-cream) 0%, var(--light-gray) 100%);
            padding: var(--spacing-xl) var(--spacing-md);
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-page-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .admin-page-header h1 {
            font-family: var(--font-heading);
            font-size: 3rem;
            color: var(--deep-burgundy);
            margin-bottom: var(--spacing-sm);
        }

        .admin-page-header .logo-admin {
            max-width: 150px;
            margin-bottom: var(--spacing-md);
        }

        .back-link {
            display: inline-block;
            margin-bottom: var(--spacing-md);
            padding: 0.75rem 1.5rem;
            background: var(--stone-gray);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: var(--deep-burgundy);
            transform: translateX(-5px);
        }

        .admin-sections {
            display: grid;
            gap: var(--spacing-lg);
        }

        .admin-section {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            color: var(--deep-burgundy);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--primary-gold);
        }

        .projects-list {
            margin-top: var(--spacing-md);
        }

        .project-item {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            margin-bottom: var(--spacing-sm);
            align-items: center;
        }

        .project-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
        }

        .project-item-info {
            flex: 1;
        }

        .project-item-info h4 {
            font-family: var(--font-heading);
            color: var(--deep-burgundy);
            margin-bottom: 0.5rem;
        }

        .project-item-info p {
            color: var(--stone-gray);
            font-size: 0.9rem;
        }

        .project-actions {
            display: flex;
            gap: 0.5rem;
        }

        .edit-btn,
        .delete-btn {
            padding: 0.75rem 1.5rem;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .edit-btn {
            background: #007bff;
        }

        .edit-btn:hover {
            background: #0056b3;
            transform: scale(1.05);
        }

        .delete-btn {
            background: #dc3545;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        /* Edit Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: var(--spacing-lg);
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--light-gray);
        }

        .modal-header h3 {
            font-family: var(--font-heading);
            color: var(--deep-burgundy);
            font-size: 1.8rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--stone-gray);
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--deep-burgundy);
        }

        .edit-images-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .edit-image-item {
            position: relative;
        }

        .edit-image-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid var(--light-gray);
        }

        .remove-image {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .remove-image:hover {
            background: #c82333;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--light-gray);
        }

        .tab-button {
            padding: 1rem 2rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: var(--font-heading);
            font-size: 1.1rem;
            color: var(--stone-gray);
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button:hover {
            color: var(--deep-burgundy);
        }

        .tab-button.active {
            color: var(--deep-burgundy);
            border-bottom-color: var(--primary-gold);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="admin-page">
        <div class="admin-container">
            <a href="index.html" class="back-link">‚Üê Volver a la Web</a>

            <div class="admin-page-header">
                <img src="img/logo.png" alt="ArtDei Logo" class="logo-admin">
                <h1>Panel de Administraci√≥n</h1>
                <p style="color: var(--stone-gray); font-size: 1.1rem;">Gestiona el contenido de ArtDei</p>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('proyectos')">üìÅ Proyectos</button>
                <button class="tab-button" onclick="switchTab('noticias')">üì∞ Noticias</button>
            </div>

            <!-- Proyectos Tab -->
            <div id="proyectos-tab" class="tab-content active">
                <div class="admin-sections">
                <!-- Add Project Section -->
                <div class="admin-section">
                    <h2 class="section-title">‚ûï Agregar Nuevo Proyecto</h2>
                    <div class="admin-panel" style="display: block; max-width: 100%; box-shadow: none; border: none; padding: 0;">
                        <form id="addProjectForm">
                            <div class="form-group">
                                <label for="projectTitle">T√≠tulo del Proyecto</label>
                                <input type="text" id="projectTitle" placeholder="Ej: Cristo Crucificado" required>
                            </div>
                            <div class="form-group">
                                <label for="projectDescription">Descripci√≥n</label>
                                <textarea id="projectDescription" placeholder="Describe los detalles del proyecto..." rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="projectImage">Im√°genes del Proyecto</label>
                                <input type="file" id="projectImage" accept="image/*" multiple required>
                                <small>Puedes seleccionar m√∫ltiples im√°genes (JPG, PNG, WEBP)</small>
                            </div>
                            <div id="imagePreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;"></div>
                            <button type="submit" class="submit-button">
                                <span>‚ûï</span> Agregar Proyecto
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Projects List Section -->
                <div class="admin-section">
                    <h2 class="section-title">üìã Proyectos Guardados</h2>
                    <div id="projectsList" class="projects-list">
                        <p style="text-align: center; color: var(--stone-gray); padding: var(--spacing-lg);">
                            No hay proyectos guardados a√∫n.
                        </p>
                    </div>
                </div>
                </div>
            </div>

            <!-- Noticias Tab -->
            <div id="noticias-tab" class="tab-content">
                <div class="admin-sections">
                <!-- Add News Section -->
                <div class="admin-section">
                    <h2 class="section-title">‚ûï Agregar Nueva Noticia</h2>
                    <div class="admin-panel" style="display: block; max-width: 100%; box-shadow: none; border: none; padding: 0;">
                        <form id="addNewsForm">
                            <div class="form-group">
                                <label for="newsTitle">T√≠tulo de la Noticia</label>
                                <input type="text" id="newsTitle" placeholder="Ej: Nuevo Retablo Terminado" required>
                            </div>
                            <div class="form-group">
                                <label for="newsDescription">Descripci√≥n</label>
                                <textarea id="newsDescription" placeholder="Describe la noticia..." rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="newsImage">Imagen de la Noticia</label>
                                <input type="file" id="newsImage" accept="image/*" required>
                                <small>Formatos aceptados: JPG, PNG, WEBP</small>
                            </div>
                            <div id="newsImagePreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;"></div>
                            <button type="submit" class="submit-button">
                                <span>‚ûï</span> Agregar Noticia
                            </button>
                        </form>
                    </div>
                </div>

                <!-- News List Section -->
                <div class="admin-section">
                    <h2 class="section-title">üìã Noticias Guardadas</h2>
                    <div id="newsList" class="projects-list">
                        <p style="text-align: center; color: var(--stone-gray); padding: var(--spacing-lg);">
                            No hay noticias guardadas a√∫n.
                        </p>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Proyecto</h3>
                <button class="close-modal" onclick="closeEditModal()">√ó</button>
            </div>
            <form id="editProjectForm">
                <input type="hidden" id="editProjectId">
                <div class="form-group">
                    <label for="editProjectTitle">T√≠tulo del Proyecto</label>
                    <input type="text" id="editProjectTitle" required>
                </div>
                <div class="form-group">
                    <label for="editProjectDescription">Descripci√≥n</label>
                    <textarea id="editProjectDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Im√°genes Actuales</label>
                    <div id="editImagesPreview" class="edit-images-preview"></div>
                </div>
                <div class="form-group">
                    <label for="editProjectImage">Agregar Nuevas Im√°genes (opcional)</label>
                    <input type="file" id="editProjectImage" accept="image/*" multiple>
                    <small>Puedes agregar m√°s im√°genes al proyecto</small>
                </div>
                <div id="newImagePreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;"></div>
                <button type="submit" class="submit-button">
                    <span>üíæ</span> Guardar Cambios
                </button>
            </form>
        </div>
    </div>

    <!-- Edit News Modal -->
    <div id="editNewsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Noticia</h3>
                <button class="close-modal" onclick="closeEditNewsModal()">√ó</button>
            </div>
            <form id="editNewsForm">
                <input type="hidden" id="editNewsId">
                <div class="form-group">
                    <label for="editNewsTitle">T√≠tulo de la Noticia</label>
                    <input type="text" id="editNewsTitle" required>
                </div>
                <div class="form-group">
                    <label for="editNewsDescription">Descripci√≥n</label>
                    <textarea id="editNewsDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Imagen Actual</label>
                    <div id="editNewsImagePreview" class="edit-images-preview"></div>
                </div>
                <div class="form-group">
                    <label for="editNewsImage">Cambiar Imagen (opcional)</label>
                    <input type="file" id="editNewsImage" accept="image/*">
                    <small>Deja en blanco para mantener la imagen actual</small>
                </div>
                <div id="newNewsImagePreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;"></div>
                <button type="submit" class="submit-button">
                    <span>üíæ</span> Guardar Cambios
                </button>
            </form>
        </div>
    </div>

    <script>
        // Tab System
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Project Manager for Admin Page
        class AdminProjectManager {
            constructor() {
                this.projects = this.loadProjects();
            }

            loadProjects() {
                const stored = localStorage.getItem('artdei_projects');
                return stored ? JSON.parse(stored) : [];
            }

            saveProjects() {
                localStorage.setItem('artdei_projects', JSON.stringify(this.projects));
            }

            addProject(title, description, imagesData) {
                const project = {
                    id: Date.now(),
                    title,
                    description,
                    images: Array.isArray(imagesData) ? imagesData : [imagesData],
                    image: Array.isArray(imagesData) ? imagesData[0] : imagesData,
                    createdAt: new Date().toISOString()
                };

                this.projects.push(project);
                this.saveProjects();
                return project;
            }

            deleteProject(id) {
                this.projects = this.projects.filter(p => p.id !== id);
                this.saveProjects();
            }

            updateProject(id, title, description, images) {
                const projectIndex = this.projects.findIndex(p => p.id === id);
                if (projectIndex !== -1) {
                    this.projects[projectIndex].title = title;
                    this.projects[projectIndex].description = description;
                    this.projects[projectIndex].images = images;
                    this.projects[projectIndex].image = images[0];
                    this.saveProjects();
                }
            }

            getProject(id) {
                return this.projects.find(p => p.id === id);
            }
        }

        const adminProjectManager = new AdminProjectManager();

        // Load and display saved projects
        function loadSavedProjects() {
            const projectsListEl = document.getElementById('projectsList');
            const stored = localStorage.getItem('artdei_projects');
            const projects = stored ? JSON.parse(stored) : [];

            if (projects.length === 0) {
                projectsListEl.innerHTML = '<p style="text-align: center; color: var(--stone-gray); padding: var(--spacing-lg);">No hay proyectos guardados a√∫n.</p>';
                return;
            }

            projectsListEl.innerHTML = projects.map(project => {
                const images = Array.isArray(project.images) ? project.images : [project.image];
                const imageCount = images.length;
                return `
                <div class="project-item" data-id="${project.id}">
                    <img src="${images[0]}" alt="${project.title}">
                    <div class="project-item-info">
                        <h4>${project.title}</h4>
                        <p>${project.description}</p>
                        <small style="color: var(--primary-gold);">Creado: ${new Date(project.createdAt).toLocaleDateString('es-ES')} | ${imageCount} imagen${imageCount > 1 ? 'es' : ''}</small>
                    </div>
                    <div class="project-actions">
                        <button class="edit-btn" onclick="openEditModal(${project.id})">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="delete-btn" onclick="deleteProject(${project.id})">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        // Delete project function
        function deleteProject(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este proyecto?')) {
                return;
            }

            adminProjectManager.deleteProject(id);
            loadSavedProjects();
            alert('Proyecto eliminado correctamente');
        }

        // Image preview
        document.getElementById('projectImage').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('imagePreview');
            previewContainer.innerHTML = '';

            const files = Array.from(e.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.width = '100px';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '6px';
                    img.style.border = '2px solid var(--primary-gold)';
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        // Add Project Form Handler
        document.getElementById('addProjectForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const title = document.getElementById('projectTitle').value;
            const description = document.getElementById('projectDescription').value;
            const imageFiles = document.getElementById('projectImage').files;

            if (imageFiles.length > 0) {
                const imagesData = [];
                let loadedCount = 0;

                Array.from(imageFiles).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagesData[index] = event.target.result;
                        loadedCount++;

                        // When all images are loaded
                        if (loadedCount === imageFiles.length) {
                            adminProjectManager.addProject(title, description, imagesData);
                            document.getElementById('addProjectForm').reset();
                            document.getElementById('imagePreview').innerHTML = '';
                            loadSavedProjects();
                            alert(`Proyecto agregado exitosamente con ${imagesData.length} imagen${imagesData.length > 1 ? 'es' : ''}`);
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }
        });

        // Edit Modal Functions
        let currentEditImages = [];

        function openEditModal(id) {
            const project = adminProjectManager.getProject(id);
            if (!project) return;

            document.getElementById('editProjectId').value = project.id;
            document.getElementById('editProjectTitle').value = project.title;
            document.getElementById('editProjectDescription').value = project.description;

            currentEditImages = Array.isArray(project.images) ? [...project.images] : [project.image];
            renderEditImages();

            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            document.getElementById('editProjectForm').reset();
            document.getElementById('newImagePreview').innerHTML = '';
            currentEditImages = [];
        }

        function renderEditImages() {
            const container = document.getElementById('editImagesPreview');
            container.innerHTML = currentEditImages.map((img, index) => `
                <div class="edit-image-item">
                    <img src="${img}" alt="Imagen ${index + 1}">
                    <button type="button" class="remove-image" onclick="removeEditImage(${index})">√ó</button>
                </div>
            `).join('');
        }

        function removeEditImage(index) {
            if (currentEditImages.length === 1) {
                alert('Debe haber al menos una imagen en el proyecto');
                return;
            }
            currentEditImages.splice(index, 1);
            renderEditImages();
        }

        // Preview new images in edit modal
        document.getElementById('editProjectImage').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('newImagePreview');
            previewContainer.innerHTML = '';

            const files = Array.from(e.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.width = '80px';
                    img.style.height = '80px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '6px';
                    img.style.border = '2px solid var(--primary-gold)';
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        // Edit Project Form Handler
        document.getElementById('editProjectForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const id = parseInt(document.getElementById('editProjectId').value);
            const title = document.getElementById('editProjectTitle').value;
            const description = document.getElementById('editProjectDescription').value;
            const newImageFiles = document.getElementById('editProjectImage').files;

            if (newImageFiles.length > 0) {
                const newImagesData = [];
                let loadedCount = 0;

                Array.from(newImageFiles).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        newImagesData[index] = event.target.result;
                        loadedCount++;

                        if (loadedCount === newImageFiles.length) {
                            const allImages = [...currentEditImages, ...newImagesData];
                            adminProjectManager.updateProject(id, title, description, allImages);
                            closeEditModal();
                            loadSavedProjects();
                            alert('Proyecto actualizado exitosamente');
                        }
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                adminProjectManager.updateProject(id, title, description, currentEditImages);
                closeEditModal();
                loadSavedProjects();
                alert('Proyecto actualizado exitosamente');
            }
        });

        // Close modal when clicking outside
        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target.id === 'editModal') {
                closeEditModal();
            }
        });

        // ==================== NEWS MANAGER ====================

        class AdminNewsManager {
            constructor() {
                this.news = this.loadNews();
            }

            loadNews() {
                const stored = localStorage.getItem('artdei_news');
                return stored ? JSON.parse(stored) : [];
            }

            saveNews() {
                localStorage.setItem('artdei_news', JSON.stringify(this.news));
            }

            addNews(title, description, imageData) {
                const newsItem = {
                    id: Date.now(),
                    title,
                    description,
                    image: imageData,
                    createdAt: new Date().toISOString()
                };

                this.news.push(newsItem);
                this.saveNews();
                return newsItem;
            }

            deleteNews(id) {
                this.news = this.news.filter(n => n.id !== id);
                this.saveNews();
            }

            updateNews(id, title, description, imageData) {
                const newsIndex = this.news.findIndex(n => n.id === id);
                if (newsIndex !== -1) {
                    this.news[newsIndex].title = title;
                    this.news[newsIndex].description = description;
                    if (imageData) {
                        this.news[newsIndex].image = imageData;
                    }
                    this.saveNews();
                }
            }

            getNews(id) {
                return this.news.find(n => n.id === id);
            }
        }

        const adminNewsManager = new AdminNewsManager();

        // Load and display saved news
        function loadSavedNews() {
            const newsListEl = document.getElementById('newsList');
            const stored = localStorage.getItem('artdei_news');
            const news = stored ? JSON.parse(stored) : [];

            if (news.length === 0) {
                newsListEl.innerHTML = '<p style="text-align: center; color: var(--stone-gray); padding: var(--spacing-lg);">No hay noticias guardadas a√∫n.</p>';
                return;
            }

            newsListEl.innerHTML = news.map(newsItem => {
                return `
                <div class="project-item" data-id="${newsItem.id}">
                    <img src="${newsItem.image}" alt="${newsItem.title}">
                    <div class="project-item-info">
                        <h4>${newsItem.title}</h4>
                        <p>${newsItem.description}</p>
                        <small style="color: var(--primary-gold);">Creado: ${new Date(newsItem.createdAt).toLocaleDateString('es-ES')}</small>
                    </div>
                    <div class="project-actions">
                        <button class="edit-btn" onclick="openEditNewsModal(${newsItem.id})">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="delete-btn" onclick="deleteNews(${newsItem.id})">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        // Delete news function
        function deleteNews(id) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar esta noticia?')) {
                return;
            }

            adminNewsManager.deleteNews(id);
            loadSavedNews();
            alert('Noticia eliminada correctamente');
        }

        // News image preview
        document.getElementById('newsImage').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('newsImagePreview');
            previewContainer.innerHTML = '';

            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.width = '100px';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '6px';
                    img.style.border = '2px solid var(--primary-gold)';
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        // Add News Form Handler
        document.getElementById('addNewsForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const title = document.getElementById('newsTitle').value;
            const description = document.getElementById('newsDescription').value;
            const imageFile = document.getElementById('newsImage').files[0];

            if (imageFile) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    adminNewsManager.addNews(title, description, event.target.result);
                    document.getElementById('addNewsForm').reset();
                    document.getElementById('newsImagePreview').innerHTML = '';
                    loadSavedNews();
                    alert('Noticia agregada exitosamente');
                };
                reader.readAsDataURL(imageFile);
            }
        });

        // Edit News Modal Functions
        let currentEditNewsImage = null;

        function openEditNewsModal(id) {
            const newsItem = adminNewsManager.getNews(id);
            if (!newsItem) return;

            document.getElementById('editNewsId').value = newsItem.id;
            document.getElementById('editNewsTitle').value = newsItem.title;
            document.getElementById('editNewsDescription').value = newsItem.description;

            currentEditNewsImage = newsItem.image;
            const container = document.getElementById('editNewsImagePreview');
            container.innerHTML = `<div class="edit-image-item"><img src="${newsItem.image}" alt="${newsItem.title}"></div>`;

            document.getElementById('editNewsModal').classList.add('active');
        }

        function closeEditNewsModal() {
            document.getElementById('editNewsModal').classList.remove('active');
            document.getElementById('editNewsForm').reset();
            document.getElementById('newNewsImagePreview').innerHTML = '';
            currentEditNewsImage = null;
        }

        // Preview new image in edit news modal
        document.getElementById('editNewsImage').addEventListener('change', function(e) {
            const previewContainer = document.getElementById('newNewsImagePreview');
            previewContainer.innerHTML = '';

            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.width = '80px';
                    img.style.height = '80px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '6px';
                    img.style.border = '2px solid var(--primary-gold)';
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        // Edit News Form Handler
        document.getElementById('editNewsForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const id = parseInt(document.getElementById('editNewsId').value);
            const title = document.getElementById('editNewsTitle').value;
            const description = document.getElementById('editNewsDescription').value;
            const newImageFile = document.getElementById('editNewsImage').files[0];

            if (newImageFile) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    adminNewsManager.updateNews(id, title, description, event.target.result);
                    closeEditNewsModal();
                    loadSavedNews();
                    alert('Noticia actualizada exitosamente');
                };
                reader.readAsDataURL(newImageFile);
            } else {
                adminNewsManager.updateNews(id, title, description, currentEditNewsImage);
                closeEditNewsModal();
                loadSavedNews();
                alert('Noticia actualizada exitosamente');
            }
        });

        // Close news modal when clicking outside
        document.getElementById('editNewsModal').addEventListener('click', (e) => {
            if (e.target.id === 'editNewsModal') {
                closeEditNewsModal();
            }
        });

        // Load projects and news on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadSavedProjects();
            loadSavedNews();
        });
    </script>
</body>
</html>